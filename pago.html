<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detalles del Pago</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .container {
            max-width: 500px;
            margin: auto;
            text-align: center;
        }
        .dato {
            font-size: 20px;
            margin: 10px 0;
        }
        #qrCode {
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Detalle del Pago</h2>

    <div class="dato"><b>ID:</b> <span id="id"></span></div>
    <div class="dato"><b>Nombre:</b> <span id="nombre"></span></div>
    <div class="dato"><b>Fecha:</b> <span id="fecha"></span></div>
    <div class="dato"><b>Monto:</b> <span id="monto"></span></div>
    <div class="dato"><b>Estado:</b> <span id="estado"></span></div>

    <h3>Código QR</h3>
    <img id="qrCode" src="" width="150">
</div>

<script>
    // ------------------------------------------
    // OBTENER ID DEL URL
    // ------------------------------------------
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");

    document.getElementById("id").textContent = id ?? "—";

    // ------------------------------------------
    // URL DEL CSV PUBLICADO (GOOGLE SHEETS)
    // ------------------------------------------
    const CSV_URL =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vT-grqqDSRtO0OvqY6yxYvtFV3CZ846L-4-P5sSsuWV-zRA3K1kmh24FE256tVdFR-E3TFfczADaoTO/pub?gid=971038428&single=true&output=csv";

    // ------------------------------------------
    // CARGAR CSV
    // ------------------------------------------
    async function cargarDatos() {
        const resp = await fetch(CSV_URL);
        const texto = await resp.text();

        const lineas = texto.split("\n").map(l => l.trim());
        const encabezados = lineas[0].split(",");

        for (let i = 1; i < lineas.length; i++) {
            const fila = lineas[i].split(",");

            if (fila[0] == id) {
                document.getElementById("nombre").textContent = fila[1];
                document.getElementById("fecha").textContent = fila[2];
                document.getElementById("monto").textContent = fila[3];
                document.getElementById("estado").textContent = fila[4];
                return;
            }
        }

        // Si no se encuentra
        document.getElementById("nombre").textContent = "No encontrado";
        document.getElementById("fecha").textContent = "—";
        document.getElementById("monto").textContent = "—";
        document.getElementById("estado").textContent = "—";
    }

    cargarDatos();

    // ------------------------------------------
    // GENERAR QR DINÁMICO
    // ------------------------------------------
    if (id) {
        const qrURL =
            "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=" +
            encodeURIComponent("https://jose06hr.github.io/prueba-2-qr/pago.html?id=" + id);

        document.getElementById("qrCode").src = qrURL;
    }
</script>

</body>
</html>
